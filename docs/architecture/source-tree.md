# Source Tree - STAGETEK CRM

**VersÃ£o**: 1.0
**Data**: 25 de Outubro de 2025
**Status**: Atual (55 componentes implementados)

---

## ğŸ“ Project Structure Overview

```
stagetek-crm-system/
â”œâ”€â”€ .ai/                      â† AI artifacts & reports
â”œâ”€â”€ .bmad-core/               â† BMAD method configuration
â”œâ”€â”€ .claude/                  â† Claude Code configuration
â”œâ”€â”€ docs/                     â† Documentation (BMAD structured)
â”œâ”€â”€ protocol/                 â† Strategic reports & analysis
â”œâ”€â”€ public/                   â† Static assets & screenshots
â”œâ”€â”€ src/                      â† Source code (main)
â”œâ”€â”€ supabase/                 â† Database migrations
â””â”€â”€ [config files]            â† vite.config, tsconfig, etc.
```

---

## ğŸ“¦ src/ Directory (Detailed)

### Complete Structure
```
src/
â”œâ”€â”€ components/           â† React components (Atomic Design)
â”‚   â”œâ”€â”€ atoms/           â† Single UI primitives (â‰¤20 lines)
â”‚   â”‚   â”œâ”€â”€ Avatar.tsx
â”‚   â”‚   â”œâ”€â”€ Badge.tsx
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Checkbox.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”œâ”€â”€ Label.tsx
â”‚   â”‚   â”œâ”€â”€ Select.tsx
â”‚   â”‚   â”œâ”€â”€ Spinner.tsx
â”‚   â”‚   â””â”€â”€ Stars.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ molecules/       â† Composition of atoms (â‰¤35 lines)
â”‚   â”‚   â”œâ”€â”€ AddressFields.tsx
â”‚   â”‚   â”œâ”€â”€ Breadcrumb.tsx
â”‚   â”‚   â”œâ”€â”€ ClientCard.tsx
â”‚   â”‚   â”œâ”€â”€ ContactCard.tsx
â”‚   â”‚   â”œâ”€â”€ ContactModal.tsx
â”‚   â”‚   â”œâ”€â”€ EmailModal.tsx
â”‚   â”‚   â”œâ”€â”€ FormField.tsx
â”‚   â”‚   â”œâ”€â”€ KanbanColumn.tsx
â”‚   â”‚   â”œâ”€â”€ ModalActions.tsx
â”‚   â”‚   â”œâ”€â”€ ModalHeader.tsx
â”‚   â”‚   â”œâ”€â”€ OpportunityCard.tsx
â”‚   â”‚   â”œâ”€â”€ ProductCard.tsx
â”‚   â”‚   â”œâ”€â”€ QuotationItem.tsx
â”‚   â”‚   â”œâ”€â”€ QuotationTotals.tsx
â”‚   â”‚   â”œâ”€â”€ SearchBar.tsx
â”‚   â”‚   â”œâ”€â”€ StatCard.tsx
â”‚   â”‚   â”œâ”€â”€ TaskCard.tsx
â”‚   â”‚   â”œâ”€â”€ TimelineItem.tsx
â”‚   â”‚   â””â”€â”€ UserMenu.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ organisms/       â† Complex UI sections (â‰¤50 lines)
â”‚   â”‚   â”œâ”€â”€ ClientTable.tsx
â”‚   â”‚   â”œâ”€â”€ ContactList.tsx
â”‚   â”‚   â”œâ”€â”€ OpportunitiesTable.tsx
â”‚   â”‚   â”œâ”€â”€ ProductCatalog.tsx
â”‚   â”‚   â”œâ”€â”€ QuotationCart.tsx
â”‚   â”‚   â”œâ”€â”€ TaskForm.tsx
â”‚   â”‚   â”œâ”€â”€ TaskList.tsx
â”‚   â”‚   â”œâ”€â”€ Timeline.tsx
â”‚   â”‚   â””â”€â”€ TopBar.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/       â† Page layouts (â‰¤30 lines)
â”‚   â”‚   â”œâ”€â”€ AuthLayout.tsx
â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/         â† Legacy (will merge with templates)
â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚
â”‚   â””â”€â”€ ui/              â† shadcn/ui base components
â”‚       â””â”€â”€ [auto-generated by shadcn CLI]
â”‚
â”œâ”€â”€ hooks/               â† Custom React hooks
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useClienteForm.ts
â”‚   â”œâ”€â”€ useContacts.ts
â”‚   â”œâ”€â”€ useEmailSending.ts
â”‚   â”œâ”€â”€ useFunnels.ts
â”‚   â”œâ”€â”€ useOportunidadeForm.ts
â”‚   â”œâ”€â”€ usePDFGeneration.ts
â”‚   â”œâ”€â”€ useQuotationActions.ts
â”‚   â””â”€â”€ useTasks.ts
â”‚
â”œâ”€â”€ lib/                 â† Utilities & configurations
â”‚   â”œâ”€â”€ supabase.ts
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ pdfStyles.ts
â”‚
â”œâ”€â”€ pages/               â† Route components (no line limit)
â”‚   â”œâ”€â”€ Clientes.tsx
â”‚   â”œâ”€â”€ ConfigFunis.tsx
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ DetalheOportunidade.tsx
â”‚   â”œâ”€â”€ Funil.tsx
â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”œâ”€â”€ NovaCotacao.tsx
â”‚   â”œâ”€â”€ Oportunidades.tsx
â”‚   â””â”€â”€ [future pages]
â”‚
â”œâ”€â”€ types/               â† TypeScript type definitions
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ test/                â† Test utilities
â”‚   â””â”€â”€ setup.ts
â”‚
â”œâ”€â”€ App.tsx              â† Root component
â”œâ”€â”€ main.tsx             â† Entry point
â””â”€â”€ index.css            â† Global styles
```

---

## ğŸ—‚ï¸ Component Inventory (55 components)

### Atoms (9 components)
| File | Lines | Purpose |
|------|-------|---------|
| Avatar.tsx | 12 | Display user/client initials |
| Badge.tsx | 15 | Status labels (Ativo, Inativo, etc.) |
| Button.tsx | 18 | Primary UI action button |
| Checkbox.tsx | 16 | Checkbox input |
| Input.tsx | 17 | Text input field |
| Label.tsx | 17 | Form label |
| Select.tsx | 19 | Dropdown select |
| Spinner.tsx | 10 | Loading indicator |
| Stars.tsx | 14 | 5-star rating display |

### Molecules (19 components)
| File | Lines | Purpose |
|------|-------|---------|
| AddressFields.tsx | 22 | Address form fields (JSONB) |
| Breadcrumb.tsx | 28 | Navigation breadcrumb |
| ClientCard.tsx | 31 | Client display card (mobile) |
| ContactCard.tsx | 30 | Contact display card |
| ContactModal.tsx | 41 | Create/edit contact |
| EmailModal.tsx | 20 | Email sending modal |
| FormField.tsx | 17 | Generic form field wrapper |
| KanbanColumn.tsx | 34 | Kanban board column |
| ModalActions.tsx | 20 | Modal footer actions |
| ModalHeader.tsx | 16 | Modal header |
| OpportunityCard.tsx | 46 | Opportunity card (Kanban) |
| ProductCard.tsx | 27 | Product catalog card |
| QuotationItem.tsx | 22 | Quotation line item |
| QuotationTotals.tsx | 35 | Quotation summary totals |
| SearchBar.tsx | 25 | Global search bar |
| StatCard.tsx | 28 | Dashboard stat card |
| TaskCard.tsx | 26 | Task display card |
| TimelineItem.tsx | 32 | Timeline activity item |
| UserMenu.tsx | 31 | User dropdown menu |

### Organisms (9 components)
| File | Lines | Purpose |
|------|-------|---------|
| ClientTable.tsx | 48 | Desktop client data table |
| ContactList.tsx | 60 | Contact management list |
| OpportunitiesTable.tsx | 50 | Desktop opportunity table |
| ProductCatalog.tsx | 45 | Product selection catalog |
| QuotationCart.tsx | 50 | Quotation cart/summary |
| TaskForm.tsx | 42 | Create/edit task form |
| TaskList.tsx | 60 | Task management list |
| Timeline.tsx | 70 | Activity timeline |
| TopBar.tsx | 42 | Global navigation bar |

### Templates (2 components)
| File | Lines | Purpose |
|------|-------|---------|
| AuthLayout.tsx | 24 | Login page layout |
| MainLayout.tsx | 25 | App main layout (TopBar + content) |

### Pages (8 components)
| File | Lines | Purpose |
|------|-------|---------|
| Clientes.tsx | 137 | Clients list & management |
| ConfigFunis.tsx | 223 | Funnel configuration editor |
| Dashboard.tsx | 85 | Main dashboard with stats |
| DetalheOportunidade.tsx | 159 | Opportunity details (6 tabs) |
| Funil.tsx | 92 | Kanban board (drag-and-drop) |
| Login.tsx | 78 | Authentication page |
| NovaCotacao.tsx | 30 | Create quotation page |
| Oportunidades.tsx | 142 | Opportunities list & management |

---

## ğŸª Custom Hooks (9 hooks)

| Hook | Lines | Purpose |
|------|-------|---------|
| useAuth.ts | 87 | Authentication state & actions |
| useClienteForm.ts | 61 | Client form state management |
| useContacts.ts | 128 | Contact CRUD operations |
| useEmailSending.ts | 95 | Email sending via Resend |
| useFunnels.ts | 172 | Funnel & stage management |
| useOportunidadeForm.ts | 67 | Opportunity form state |
| usePDFGeneration.ts | 112 | PDF generation logic |
| useQuotationActions.ts | 145 | Quotation CRUD operations |
| useTasks.ts | 205 | Task CRUD operations |

---

## ğŸ“š Key Files Description

### lib/supabase.ts
```typescript
// Supabase client singleton
import { createClient } from '@supabase/supabase-js'

export const supabase = createClient(
  process.env.VITE_SUPABASE_URL!,
  process.env.VITE_SUPABASE_ANON_KEY!
)
```

### types/index.ts
```typescript
// Central type definitions (all interfaces/types)
export interface Client { ... }
export interface Opportunity { ... }
export interface Task { ... }
export type Status = 'active' | 'inactive'
export type Temperature = 'hot' | 'warm' | 'cold'
```

### App.tsx
```typescript
// Root component with React Router
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import ProtectedRoute from './components/ProtectedRoute'

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/login" element={<Login />} />
        <Route path="/" element={<ProtectedRoute><MainLayout /></ProtectedRoute>}>
          <Route index element={<Dashboard />} />
          <Route path="clientes" element={<Clientes />} />
          {/* ... other routes */}
        </Route>
      </Routes>
    </BrowserRouter>
  )
}
```

---

## ğŸ—„ï¸ Database Integration Points

### Supabase Tables Used
- `clients` - Client CRUD in Clientes.tsx
- `opportunities` - Opportunity CRUD in Oportunidades.tsx
- `funnel_stages` - Stages in Funil.tsx + ConfigFunis.tsx
- `funnels` - Pipeline management in ConfigFunis.tsx
- `tasks` - Task CRUD in TaskList.tsx
- `notes` - Timeline activities in Timeline.tsx
- `contacts` - Contact CRUD in ContactList.tsx
- `products` - Product catalog in NovaCotacao.tsx
- `quotations` - Quotation CRUD in NovaCotacao.tsx

---

## ğŸš€ Route Map

### Public Routes
- `/login` - Login.tsx (authentication)

### Protected Routes (requires auth)
- `/` - Dashboard.tsx (redirect to /dashboard)
- `/dashboard` - Dashboard.tsx (stats & charts)
- `/clientes` - Clientes.tsx (client management)
- `/oportunidades` - Oportunidades.tsx (opportunity list)
- `/oportunidades/:id` - DetalheOportunidade.tsx (opportunity details)
- `/oportunidades/:id/cotacao/nova` - NovaCotacao.tsx (create quotation)
- `/funil` - Funil.tsx (Kanban board)
- `/configuracoes/funis` - ConfigFunis.tsx (funnel editor)

### Planned Routes
- `/cotacoes` - List all quotations (future)
- `/tarefas` - Global task list (future)
- `/contatos` - Contact management page (future)
- `/relatorios` - Reports & analytics (future)

---

## ğŸ“¦ External Dependencies Used

### Component Libraries
- `lucide-react` - Icons (Phone, Mail, ChevronDown, etc.)
- `@dnd-kit/*` - Drag-and-drop in Funil.tsx
- `@react-pdf/renderer` - PDF generation in NovaCotacao.tsx
- `recharts` - Charts in Dashboard.tsx (planned)

### Form Libraries
- `react-hook-form` - Form state in modals
- `zod` - Validation schemas

### Date Libraries
- `date-fns` - Date formatting (PT-BR)

---

## ğŸ”„ Component Dependency Graph

```
App.tsx
 â””â”€ MainLayout (template)
     â”œâ”€ TopBar (organism)
     â”‚   â”œâ”€ SearchBar (molecule)
     â”‚   â””â”€ UserMenu (molecule)
     â”‚       â””â”€ Avatar (atom)
     â”‚
     â””â”€ Pages (route-based)
         â”œâ”€ Clientes.tsx
         â”‚   â”œâ”€ ClientTable (organism)
         â”‚   â””â”€ ClientCard (molecule)
         â”‚       â”œâ”€ Avatar (atom)
         â”‚       â””â”€ Badge (atom)
         â”‚
         â”œâ”€ Funil.tsx
         â”‚   â”œâ”€ KanbanColumn (molecule)
         â”‚   â””â”€ OpportunityCard (molecule)
         â”‚       â”œâ”€ Avatar (atom)
         â”‚       â””â”€ Stars (atom)
         â”‚
         â””â”€ DetalheOportunidade.tsx
             â”œâ”€ Timeline (organism)
             â”‚   â””â”€ TimelineItem (molecule)
             â”œâ”€ TaskList (organism)
             â”‚   â”œâ”€ TaskCard (molecule)
             â”‚   â””â”€ TaskForm (organism)
             â””â”€ ContactList (organism)
                 â”œâ”€ ContactCard (molecule)
                 â””â”€ ContactModal (molecule)
                     â””â”€ FormField (molecule)
                         â”œâ”€ Label (atom)
                         â””â”€ Input (atom)
```

---

## ğŸ§¹ Code Organization Rules

### Protocol Notecraftâ„¢ Compliance
- âœ… All components within line limits
- âœ… Clear separation of concerns (atoms â†’ molecules â†’ organisms)
- âœ… No circular dependencies
- âœ… Single responsibility principle

### Import Path Aliases
```typescript
// Use @ alias for clean imports
import { supabase } from '@/lib/supabase'
import { Button } from '@/components/atoms'
import type { Client } from '@/types'
```

### File Naming
- Components: PascalCase (ClientCard.tsx)
- Hooks: camelCase with "use" prefix (useAuth.ts)
- Utils: camelCase (utils.ts)
- Types: lowercase (index.ts)

---

**Ãšltima atualizaÃ§Ã£o**: 25 de Outubro de 2025
**Total componentes**: 55
**Total hooks**: 9
**Total pÃ¡ginas**: 8
