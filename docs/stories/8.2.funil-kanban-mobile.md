# Story 8.2: Funil Kanban Mobile

**Epic**: EPIC-008 UX Mobile | **Status**: Draft | **Prioridade**: P0 | **Estimativa**: 1-2 horas

## Story
Como vendedor mobile, quero navegar pelo kanban de vendas com feedback visual claro de que há mais colunas para scrollar.

## AC
1. **Scroll Horizontal com Affordance:**
   - Gradiente sutil à direita indicando mais conteúdo
   - Snap scroll (uma coluna por vez)
   - Indicador de página (dots) abaixo do kanban

2. **FilterBar Collapsible:**
   - Desktop: Sticky no topo (atual)
   - Mobile: Botão "Filtros (3)" que abre Sheet/Drawer
   - Economizar espaço vertical (~80px)

3. **Touch-Friendly Drag-and-Drop:**
   - Aumentar touch targets dos cards
   - Feedback visual ao arrastar (escala + sombra)
   - Haptic feedback (se disponível)

4. **Performance:**
   - Lazy render de colunas off-screen
   - Throttle do scroll event

## Tasks
- [ ] Adicionar gradiente à direita do container de colunas
- [ ] Implementar snap scroll (scroll-snap-type: x mandatory)
- [ ] Criar indicador de dots (página atual)
- [ ] Converter FilterBar para Sheet/Drawer em mobile
- [ ] Aumentar touch targets dos cards (min 44x44px)
- [ ] Testar drag-and-drop em touch device real

## Dev Notes
**Arquivos afetados:**
- `src/pages/Funil.tsx:150-152` - FilterBar sticky
- `src/pages/Funil.tsx:155-164` - Kanban columns container
- `src/components/molecules/KanbanColumn.tsx` - Touch targets
- `src/components/organisms/OpportunityCard.tsx` - Card interactions

**Solução Scroll com Affordance:**
```tsx
<div className="relative">
  {/* Kanban columns */}
  <div className="flex gap-4 overflow-x-auto pb-4 scroll-smooth snap-x snap-mandatory">
    {stages.map((stage, idx) => (
      <KanbanColumn
        key={stage.id}
        className="snap-center"
        onScrollIntoView={() => setActiveStageIndex(idx)}
        ...
      />
    ))}
  </div>

  {/* Gradiente → indicando mais conteúdo */}
  <div className="absolute right-0 top-0 bottom-4 w-16 bg-gradient-to-l from-black to-transparent pointer-events-none md:hidden" />

  {/* Dots indicator (mobile only) */}
  <div className="flex justify-center gap-1 mt-2 md:hidden">
    {stages.map((_, i) => (
      <div
        key={i}
        className={`w-2 h-2 rounded-full transition-colors ${
          i === activeStageIndex ? 'bg-[#e90101]' : 'bg-white/20'
        }`}
      />
    ))}
  </div>
</div>
```

**Solução FilterBar Collapsible:**
```tsx
{/* Desktop: Sticky (atual) */}
<div className="hidden md:block sticky top-0 z-20 bg-gradient-to-br ... mb-4">
  <FilterBar onRefresh={fetchData} />
</div>

{/* Mobile: Sheet/Drawer */}
<div className="md:hidden mb-4">
  <Sheet>
    <SheetTrigger asChild>
      <Button variant="outline" className="w-full">
        <Filter className="w-4 h-4 mr-2" />
        Filtros {activeFiltersCount > 0 && `(${activeFiltersCount})`}
        <ChevronDown className="w-4 h-4 ml-auto" />
      </Button>
    </SheetTrigger>
    <SheetContent side="bottom" className="h-[80vh]">
      <FilterBar onRefresh={fetchData} />
    </SheetContent>
  </Sheet>
</div>
```

**Solução Snap Scroll:**
```css
/* Tailwind classes */
.scroll-smooth - smooth scroll behavior
.snap-x - horizontal snap
.snap-mandatory - sempre snap
.snap-center - snap no centro da coluna
```

**State Management:**
```tsx
const [activeStageIndex, setActiveStageIndex] = useState(0)

// Detectar scroll para atualizar dots
const handleScroll = (e) => {
  const scrollLeft = e.target.scrollLeft
  const columnWidth = e.target.firstChild.offsetWidth + 16 // width + gap
  const index = Math.round(scrollLeft / columnWidth)
  setActiveStageIndex(index)
}
```

**Componentes a Criar/Usar:**
- `Sheet` (shadcn/ui) para FilterBar mobile
- `ScrollIndicator` atom (<20 linhas) para dots

**Protocol Notecraft:**
- Funil.tsx: 173 linhas (dentro do limite)
- Extrair lógica de scroll para custom hook `useKanbanScroll`

**Performance:**
- Intersection Observer para lazy render de colunas
- `will-change: transform` no container de scroll
- Throttle scroll event (200ms)

**Testes:**
- iPad landscape (scroll horizontal natural)
- iPhone portrait (scroll uma coluna por vez)
- Drag-and-drop em touch screen
