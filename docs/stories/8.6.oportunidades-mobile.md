# Story 8.6: Oportunidades Mobile - Ajustes Finos

**Epic**: EPIC-008 UX Mobile | **Status**: Draft | **Prioridade**: P1 | **Estimativa**: 30 min

---

## üìù Story

Como **vendedor mobile**, quero **visualizar e gerenciar oportunidades** em dispositivos m√≥veis, para acompanhar pipeline de vendas e criar novas oportunidades em campo.

---

## ‚úÖ Status Atual (Descoberta)

**√ìTIMA NOT√çCIA**: Oportunidades j√° est√° **90-95% mobile-ready**! üéâ

### O Que J√Å Funciona Bem ‚úÖ
- **Altern√¢ncia Table/Cards**: Desktop mostra tabela completa, mobile mostra cards customizados
- **Cards Mobile Bem Estruturados**: T√≠tulo, cliente, valor, est√°gio, status, a√ß√µes
- **SearchBar**: Input com placeholder adequado
- **Bot√£o "Nova Oportunidade"**: Responsivo (`w-full md:w-auto`)
- **OportunidadeModal**: Funcional

**Arquivo**: `src/pages/Oportunidades.tsx` (245 linhas)

**Padr√£o Implementado** (linhas 155-233):
```tsx
{/* Desktop: Table */}
<div className="hidden md:block ...">
  <table className="w-full">
    {/* 6 colunas: Nome, Cliente, Valor, Est√°gio, Status, A√ß√µes */}
  </table>
</div>

{/* Mobile: Cards */}
<div className="md:hidden space-y-4">
  {filteredOpportunities.map((opp) => (
    <div key={opp.id} className="... p-4">
      <div className="flex justify-between items-start mb-3">
        <div onClick={() => navigate(...)} className="cursor-pointer flex-1">
          <h3>{opp.title}</h3>
          <p className="text-sm text-gray-300">{opp.client.name}</p>
        </div>
        {getStatusBadge(opp.status)}
      </div>
      <div className="flex justify-between items-center mb-3">
        <span className="text-lg font-bold">{formatCurrency(opp.value)}</span>
        <span className="text-sm">{opp.stage.name}</span>
      </div>
      <div className="flex justify-end space-x-3">
        {/* A√ß√µes */}
      </div>
    </div>
  ))}
</div>
```

‚úÖ **Padr√£o correto e bem estruturado!**

---

## üîç Problemas Identificados (Ajustes Finos)

### P1: Bot√µes de A√ß√£o Pequenos em Mobile
**Problema**:
- Bot√µes "Nova Cota√ß√£o", "Editar", "Excluir" s√£o apenas texto (sem background)
- Podem ter touch targets pequenos (<44px)

**C√≥digo Atual** (`Oportunidades.tsx:225-229`):
```tsx
<div className="flex justify-end space-x-3">
  <button onClick={...} className="text-sm text-blue-400 hover:text-blue-300">Nova Cota√ß√£o</button>
  <button onClick={...} className="text-sm text-stagetek-red hover:text-[#ff0101]">Editar</button>
  <button onClick={...} className="text-sm text-danger hover:text-red-400">Excluir</button>
</div>
```

**Solu√ß√£o**:
```tsx
<div className="flex justify-end gap-2">
  <button className="px-3 py-2 text-sm text-blue-400 hover:bg-blue-500/10 rounded-lg">
    Nova Cota√ß√£o
  </button>
  <button className="px-3 py-2 text-sm text-stagetek-red hover:bg-[#e90101]/10 rounded-lg">
    Editar
  </button>
  <button className="px-3 py-2 text-sm text-danger hover:bg-red-500/10 rounded-lg">
    Excluir
  </button>
</div>
```

**Impacto**: √Årea clic√°vel aumenta de ~30px para ~44px

---

### P2: OportunidadeModal N√£o √© Fullscreen em Mobile
**Problema**:
- Similar ao ClienteModal
- Formul√°rio com muitos campos (T√≠tulo, Cliente, Valor, Est√°gio, Probabilidade, etc.)

**Solu√ß√£o**:
- Modal fullscreen em mobile (<768px)

**Arquivo**: `src/components/organisms/OportunidadeModal.tsx`

---

### P3: SearchBar Ocupa Linha Inteira
**Problema**:
- OK para usabilidade, mas ocupa ~60px verticais

**C√≥digo Atual** (`Oportunidades.tsx:145-153`):
```tsx
<div className="mb-6">
  <input
    type="text"
    value={search}
    onChange={(e) => setSearch(e.target.value)}
    placeholder="Buscar por nome ou cliente..."
    className="w-full px-4 py-3 bg-white/8 border border-white/15 rounded-lg ..."
  />
</div>
```

**Status**: ‚úÖ **J√° est√° correto!** (SearchBar com altura adequada)

---

### P4: Empty State
**Problema**:
- Padding pode ser excessivo em mobile

**C√≥digo Atual** (`Oportunidades.tsx:169-174` e `207-211`):
```tsx
{/* Desktop empty */}
<td colSpan={6} className="px-6 py-12 text-center text-gray-300">
  Nenhuma oportunidade encontrada
</td>

{/* Mobile empty */}
<div className="... p-6 text-center text-gray-300">
  Nenhuma oportunidade encontrada
</div>
```

**Solu√ß√£o**: Reduzir `py-12` para `py-6 md:py-12` na tabela

---

### P5: Cards Mobile com Muita Informa√ß√£o
**Problema**:
- Cards mostram: T√≠tulo, Cliente, Valor, Est√°gio, Status, 3 bot√µes
- Pode ficar polu√≠do visualmente

**Status**: ‚úÖ **Layout est√° bom!** Informa√ß√£o √© essencial para vendedores

---

## ‚úÖ Acceptance Criteria (AC)

### AC1: Touch Targets Adequados nos Cards
- [ ] Bot√µes "Nova Cota√ß√£o", "Editar", "Excluir" t√™m m√≠nimo 44x44px
- [ ] Padding `px-3 py-2` adiciona √°rea clic√°vel
- [ ] Hover state visual (background color change)

### AC2: Modal Fullscreen em Mobile
- [ ] Mobile (<768px): OportunidadeModal ocupa 100% da tela
- [ ] Desktop (‚â•768px): Modal centralizado
- [ ] Teclado virtual n√£o esconde campos

### AC3: Empty State Responsivo
- [ ] Padding reduzido na tabela (`py-6 md:py-12`)
- [ ] Cards mobile mant√™m padding atual (OK)

### AC4: Valida√ß√£o Cross-Device
- [ ] Testar em iPhone SE (375px)
- [ ] Testar em iPad (768px)
- [ ] Lighthouse Mobile Score ‚â• 85

---

## üéØ Tasks

### Task 1: Touch Targets nos Bot√µes Mobile (10 min)
- [ ] Alterar `Oportunidades.tsx:225-229` - adicionar `px-3 py-2 rounded-lg hover:bg-*/10`
- [ ] Testar cliques em mobile (375px)
- [ ] Validar √°rea de toque adequada

### Task 2: Modal Fullscreen em Mobile (15 min)
- [ ] Ler `OportunidadeModal.tsx` - verificar `<DialogContent>`
- [ ] Adicionar classes responsivas (similar a ClienteModal):
  ```tsx
  className="h-full w-full max-w-full m-0 rounded-none md:h-auto md:w-auto md:max-w-2xl md:m-4 md:rounded-lg"
  ```
- [ ] Testar abertura do modal em mobile

### Task 3: Empty State Tabela (2 min)
- [ ] Alterar `py-12` para `py-6 md:py-12` em `Oportunidades.tsx:171`

### Task 4: Testes Mobile (10 min)
- [ ] Abrir `/oportunidades` em Chrome DevTools (375px)
- [ ] Testar busca, criar oportunidade
- [ ] Clicar nos bot√µes de a√ß√£o
- [ ] Lighthouse audit mobile

---

## üìê Dev Notes

### Arquivos Afetados
- `src/pages/Oportunidades.tsx` (245 linhas) - Bot√µes touch targets, empty state
- `src/components/organisms/OportunidadeModal.tsx` - Modal fullscreen

### Mudan√ßas Espec√≠ficas

**Oportunidades.tsx Bot√µes Mobile** (antes):
```tsx
<div className="flex justify-end space-x-3">
  <button onClick={() => navigate(`/oportunidades/${opp.id}/cotacao/nova`)}
    className="text-sm text-blue-400 hover:text-blue-300">
    Nova Cota√ß√£o
  </button>
  <button onClick={() => handleEdit(opp)}
    className="text-sm text-stagetek-red hover:text-[#ff0101]">
    Editar
  </button>
  <button onClick={() => handleDelete(opp.id)}
    className="text-sm text-danger hover:text-red-400">
    Excluir
  </button>
</div>
```

**Oportunidades.tsx Bot√µes Mobile** (depois):
```tsx
<div className="flex justify-end gap-2">
  <button
    onClick={() => navigate(`/oportunidades/${opp.id}/cotacao/nova`)}
    className="px-3 py-2 text-sm text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors"
  >
    Nova Cota√ß√£o
  </button>
  <button
    onClick={() => handleEdit(opp)}
    className="px-3 py-2 text-sm text-stagetek-red hover:bg-[#e90101]/10 rounded-lg transition-colors"
  >
    Editar
  </button>
  <button
    onClick={() => handleDelete(opp.id)}
    className="px-3 py-2 text-sm text-danger hover:bg-red-500/10 rounded-lg transition-colors"
  >
    Excluir
  </button>
</div>
```

**OportunidadeModal.tsx** (mesmo padr√£o de ClienteModal):
```tsx
<DialogContent className="
  h-full w-full max-w-full m-0 rounded-none
  md:h-auto md:w-auto md:max-w-2xl md:m-4 md:rounded-lg
">
  <DialogHeader>
    <DialogTitle className="text-lg md:text-xl">
      {opportunity ? 'Editar Oportunidade' : 'Nova Oportunidade'}
    </DialogTitle>
  </DialogHeader>
  <div className="overflow-y-auto max-h-[calc(100vh-8rem)] md:max-h-[60vh]">
    {/* Form com scroll */}
  </div>
</DialogContent>
```

---

## üß™ Testing

### Testes Visuais
- [ ] iPhone SE (375px): Cards bem espa√ßados
- [ ] iPad (768px): Transi√ß√£o para tabela
- [ ] Desktop (1440px): Tabela completa com 6 colunas

### Testes de Intera√ß√£o
- [ ] Clicar em t√≠tulo de oportunidade ‚Üí navega para detalhe
- [ ] Clicar em "Nova Cota√ß√£o" ‚Üí navega para `/oportunidades/:id/cotacao/nova`
- [ ] Clicar em "Editar" ‚Üí modal abre (fullscreen mobile)
- [ ] Clicar em "Excluir" ‚Üí confirma√ß√£o aparece
- [ ] √Årea de toque adequada (n√£o clicar acidentalmente)

### Testes de Modal
- [ ] Abrir modal "Nova Oportunidade" em mobile
- [ ] Preencher todos os campos (T√≠tulo, Cliente, Valor, etc.)
- [ ] Teclado virtual abre ‚Üí scroll autom√°tico?
- [ ] Salvar ‚Üí modal fecha, lista atualiza

### Performance
- [ ] Lighthouse Mobile Performance ‚â• 85
- [ ] Lighthouse Mobile Accessibility ‚â• 90
- [ ] Lista de 50 oportunidades renderiza sem lag

---

## üìä Definition of Done (DoD)

- [ ] C√≥digo segue Protocol Notecraft‚Ñ¢
  - [ ] Oportunidades.tsx ‚â§ 250 linhas (dentro do limite)
  - [ ] OportunidadeModal.tsx ‚â§ 75 linhas (organism)
  - [ ] TypeScript strict mode
- [ ] Testes manuais passando
  - [ ] 3 dispositivos testados
  - [ ] Modal fullscreen funcional
  - [ ] Touch targets ‚â• 44px
- [ ] Lighthouse Mobile ‚â• 85
- [ ] Code review aprovado

---

## üé¨ Demo Script (Apresenta√ß√£o)

**Cen√°rio**: Vendedor acompanha pipeline de vendas no celular

**Passos**:
1. Abrir `/oportunidades` em iPhone (375px)
2. Ver lista de oportunidades como cards
3. Buscar por "CNPJ 123" ‚Üí filtro em tempo real
4. Clicar em "Nova Oportunidade" (bot√£o full-width)
5. Modal abre em fullscreen
6. Preencher T√≠tulo, Cliente (select), Valor, Est√°gio
7. Salvar ‚Üí Modal fecha, oportunidade aparece no topo
8. Clicar em "Nova Cota√ß√£o" de uma oportunidade
9. Navega para `/oportunidades/:id/cotacao/nova`
10. Voltar, clicar em t√≠tulo de oportunidade
11. Navega para `/oportunidades/:id` (detalhe completo)

**Valida√ß√£o**:
- Tempo para criar oportunidade < 45 segundos
- Todos os bot√µes respondem ao toque
- Modal 100% vis√≠vel (fullscreen)
- Navega√ß√£o fluida sem delays

---

## üìù Notas Adicionais

### Descoberta Importante ‚úÖ
Oportunidades tem **excelente estrutura mobile**:
- Cards bem estruturados (t√≠tulo, cliente, valor, est√°gio, status, a√ß√µes) ‚úÖ
- Table/Cards alternando corretamente ‚úÖ
- SearchBar funcional ‚úÖ
- Navega√ß√£o para detalhe implementada ‚úÖ

**Esfor√ßo real**: ~30 min (apenas touch targets e modal)

### Componentes Reutiliz√°veis
- Cards mobile inline (n√£o componente separado) - OK, simples
- `OportunidadeModal` - Precisa fullscreen mobile
- `getStatusBadge()` - Helper bem implementado ‚úÖ

### Oportunidades de Melhoria Futura (Fora do Escopo)
- ‚è≥ Filtros avan√ßados (por est√°gio, respons√°vel, data)
- ‚è≥ Ordena√ß√£o customizada (valor, data, etc.)
- ‚è≥ Exportar lista (CSV/Excel)
- ‚è≥ Drag-and-drop para mudar est√°gio (como no Funil Kanban)
- ‚è≥ Quick actions inline (marcar won/lost sem abrir modal)

---

**Story criada por**: James (Full Stack Developer)
**Data**: 12 de Dezembro de 2025
**Status**: Draft - Pronto para implementa√ß√£o
**Pr√≥xima a√ß√£o**: Implementar Tasks 1-4 (~30 min)
